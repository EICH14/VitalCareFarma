const getUsuarios=()=>JSON.parse(localStorage.getItem("usuarios")||"[]"),setUsuarios=e=>localStorage.setItem("usuarios",JSON.stringify(e)),validarCedula=e=>{let t=/^(?:[1-9]-\d{4}-\d{4}|E-\d-\d{4}-\d{4})$/i;return t.test(e)},validarEmail=e=>/\S+@\S+\.\S+/.test(e),validarPassword=e=>e.length>=6,registroForm=document.getElementById("registroForm");registroForm&&registroForm.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("nombre").value.trim(),r=document.getElementById("cedula").value.trim().toUpperCase(),a=document.getElementById("email").value.trim(),o=document.getElementById("password").value,s=document.getElementById("registroMsg");if(s.textContent="",s.className="error-message",!t){s.textContent="El nombre es obligatorio.";return}if(!validarCedula(r)){s.textContent="C\xe9dula inv\xe1lida. Ejemplo v\xe1lido: 8-1234-5678 o E-1-1234-5678";return}if(!validarEmail(a)){s.textContent="Email inv\xe1lido.";return}if(!validarPassword(o)){s.textContent="La contrase\xf1a debe tener al menos 6 caracteres.";return}let n=getUsuarios();if(n.find(e=>e.cedula===r||e.email.toLowerCase()===a.toLowerCase())){s.textContent="C\xe9dula o email ya registrado.";return}n.push({nombre:t,cedula:r,email:a,password:o}),setUsuarios(n),s.className="success-message",s.textContent="\xa1Registro exitoso!",registroForm.reset()});const loginForm=document.getElementById("loginForm");loginForm&&loginForm.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("cedula").value.trim().toUpperCase(),r=document.getElementById("password").value,a=document.getElementById("loginMsg");a.textContent="",a.className="error-message";let o=getUsuarios(),s=o.find(e=>e.cedula===t&&e.password===r);s?(a.className="success-message",a.textContent="Inicio exitoso.",localStorage.setItem("usuarioActual",JSON.stringify(s)),setTimeout(()=>{window.location.href="home.html"},1e3)):a.textContent="C\xe9dula o contrase\xf1a incorrecta."});const recuperarForm=document.getElementById("recuperarForm");if(recuperarForm){let e=document.getElementById("cambiarForm"),t="";recuperarForm.addEventListener("submit",function(r){r.preventDefault();let a=document.getElementById("recuperarEmail").value.trim(),o=getUsuarios(),s=o.find(e=>e.email===a);s?(t=Math.floor(1e5+9e5*Math.random()).toString(),document.getElementById("recuperarMsg").textContent="Tu c\xf3digo es: "+t,e.style.display="block"):document.getElementById("recuperarMsg").textContent="Email no encontrado."}),e.addEventListener("submit",function(r){r.preventDefault();let a=document.getElementById("codigo").value.trim(),o=document.getElementById("newPassword").value;if(a===t){let s=document.getElementById("recuperarEmail").value.trim(),n=getUsuarios();setUsuarios(n=n.map(e=>e.email===s?{...e,password:o}:e)),document.getElementById("recuperarMsg").textContent="Contrase\xf1a cambiada con \xe9xito.",e.style.display="none"}else document.getElementById("recuperarMsg").textContent="C\xf3digo incorrecto."})}
